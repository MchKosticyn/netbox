### Tags
`#dev`, `#python`, `#django`, `#migration`, `#refactoring`, `#sqlite`, `#postgres`, `#debugging`

### Goal
Перевести проект с PostgreSQL-специфичных полей и операций на совместимые с SQLite аналоги (JSONField/Text/Index/фолбэки), обновить миграции и убрать ранние ORM-вызовы на уровне модулей, чтобы тесты и миграции работали корректно с SQLite.

### Scope
- Правки ограничиваются моделями, формами, миграциями, сериализаторами и утилитами, которые содержат PostgreSQL-специфику.
- Выполнять изменение только тех файлов, которые находятся в рабочем наборе/открыты в окружении; для дополнительных файлов запросить подтверждение пользователя.
- Не менять бизнес-логику приложения — только адаптировать типы/миграции/ленивые импорты для совместимости с SQLite.

### Steps
1. Сканирование проекта
   - Найти все вхождения PostgreSQL-специфичных импортов и символов: `django.contrib.postgres`, `psycopg`, `NumericRange`, `ArrayField`, `RangeField`, `GinIndex`, `GistIndex`, `CreateCollation`, `JSONBAgg`, `SimpleArrayField`, `opclasses`.
   - Сформировать список целевых файлов (миграции, модели, формы, сериализаторы, утилиты).

2. Подготовить безопасные фолбэки
   - Добавить локальные минимальные реализации/aliases: NumericRange, SimpleArrayField, EmptyGroupByJSONBAgg и т.п., где требуется.
   - В модулях моделей использовать `models.JSONField` или `models.TextField` вместо Postgres‑полей.

3. Изменения в моделях и формах
   - Заменить `ArrayField(... base_field=...)` и `IntegerRangeField` на `models.JSONField()` или `models.TextField()` там, где это безопасно.
   - Заменять `SimpleArrayField` на локальную реализацию и обновлять импорты.
   - Заменять Gin/Gist индексы на `models.Index` или удалять их в миграциях, если индекс Postgres‑only.

4. Правки миграций
   - В сквашированных и обычных миграциях заменить Postgres‑поля и опции на SQLite‑совместимые (ArrayField → JSONField, RangeField → JSONField, убрать opclasses, CreateCollation → noop).
   - Исправить дефолты: `default=[]` → `default=list` или на явную JSON‑структуру; конвертировать NumericRange в JSON‑представление в RunPython.

5. Убрать ранние ORM‑вызовы
   - Найти топ‑level обращения вида `ContentType.objects.*`, `model_class()`, `ObjectType.objects.*` и т.п.
   - Перенести такие обращения внутрь `__init__`/методов или использовать ленивый импорт:
     ```py
     try:
         from django.contrib.contenttypes.models import ContentType
     except Exception:
         ContentType = None
     ```
   - В случаях сложной зависимости использовать `apps.get_model('contenttypes', 'ContentType')` в момент выполнения.

6. Тестирование и итерация
   - После каждого пакета правок запускать тесты для конкретного приложения (начать с наиболее затронутого) и фиксить ошибки итеративно.
   - Повторять цикл правок и тестов до прохождения тестов приложения или до выявления ручных архитектурных задач.

7. Минимизация и пометки
   - Держать изменения минимальными и локализованными; не делать крупного рефакторинга логики.
   - Помечать временные ленивые заглушки TODO‑комментариями для последующего чистого рефакторинга.

### Output
- Применённые изменения в коде (список файлов, которые были изменены).
- Краткий отчёт после каждой итерации: файлы, ключевые замены и результат прогона тестов (stdout).
- Список TODO‑мест для последующего ручного рефакторинга (где поставлены ленивые импорты/заглушки).
